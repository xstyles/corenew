!function(l){function d(t){t=function(t,r){for(key in r)r.hasOwnProperty(key)&&void 0===t[key]&&(t[key]=r[key]);return t}(t,{intent:"",total:0,formId:null,amount:null,amountType:null,products:null,productsType:null,includeShipping:!0,includeDiscounts:!1,calculateByProduct:!1});var r,a=0,n=l.isArray(t.products)&&0<t.products.length?f(t.formId,t.products,t.includeDiscounts):0;switch(t.amount||(t.amount=0),t.includeShipping||(t.total-=(r=t.formId,gformGetShippingPrice(r))),t.productsType){case"include":t.total=n;break;case"exclude":t.total-=n}switch(t.amountType){case null:a=t.total;break;case"percent":a=t.total*(t.amount/100);break;default:var o=t.amount;if(t.calculateByProduct){var i=s(t.formId);o*=100*t.total/i/100}a=o}return a=Math.max(0,parseFloat(a))}function f(t,r,a){if(void 0===r&&window._gformPriceFields?r=_gformPriceFields[t]:l.isArray(r)||(r=[r]),!r)return 0;for(var n=0,o=0;o<r.length;o++){var i=gformCalculateProductPrice(t,r[o]);if(n+=i,a)n-=Math.abs(p(t,i,r[o]))+(jQuery("#gf_coupons_"+t).val()?e(t,i):0)}return n}function s(t,r){return f(t)-(void 0!==r&&r?f(t,r):0)}function p(i,e,u){var t=l("#gform_wrapper_"+i+" .ginput_discount_input"),c=0;return t.each(function(){var t=l(this).val(),r=l(this).data("products"),a=l(this).data("productstype");if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;if(u&&r){if("include"==a&&(-1===l.inArray(u,r)||0===parseInt(e)))return!0;if("exclude"==a&&(-1!==l.inArray(u,r)||0===parseInt(e)))return!0}var n=u&&0<u,o=d({intent:"Calculating discount for Discount field {0}".format(l(this).attr("id")),total:e,formId:i,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:r,productsType:a,includeShipping:!1,calculateByProduct:n});"include"===a&&0<r.length&&(o=Math.min(f(i,r,!1),o)),o*=-1,o=gform.applyFilters("gpecf_discount_total",o,l(this)),n||String(t)===String(o)||l(this).val(o).change(),c+=o}),c}function e(t,r){var a,n,o=window["gf_coupons"+t],i=0;for(a in o)o.hasOwnProperty(a)&&(n=o[a],i+=GetDiscount(n.type,n.amount,r,i));return i}function u(t){var r=rgars(window,"gf_global/gfcalc/{0}".format(t));if(r){for(var a=[],n=0;n<r.formulaFields.length;n++){var o=r.formulaFields[n];g(o.formula)&&a.push(o)}a.length&&r.runCalcs(t,a)}}function g(t){var r=-1!=t.search("{coupons}"),a=-1!=t.search("{discounts}"),n=-1!=t.search("{subtotal}");return r||a||n}function i(t,r){return Number(Math.round(t+"e"+r)+"e-"+r)}gform.addFilter("gform_calculation_formula",function(t,r,a,n){if(!g(t))return t;var o=l("#field_{0}_{1}".format(a,r.field_id)).hasClass("gfield_price");if(o&&(!window._gformPriceFields||!window._gformPriceFields.length))return t=(t=(t=t.replace(/{coupons}/gi,0)).replace(/{discounts}/gi,0)).replace(/{subtotal}/gi,0);var i=""!=(gformIsHidden(l("#gf_coupon_code_"+a))?"":l("#gf_coupon_codes_"+a).val())||""!=l("#gf_coupons_"+a).val(),e=l("#gf_total_no_discount_"+a).val(),u=0,c=-1*p(a,s(a));return void 0!==e&&i&&window.PopulateDiscountInfo&&(u=PopulateDiscountInfo(e,a)),t=(t=(t=t.replace(/{coupons}/gi,parseFloat(u))).replace(/{discounts}/gi,parseFloat(c+u))).replace(/{subtotal}/gi,parseFloat(s(a,o?[r.field_id]:null)))}),gform.addFilter("gform_coupons_discount_amount",function(t,r,a,n,o){var i=arguments.callee.caller.caller.caller.caller;if("PopulateDiscountInfo"!=i.name)return t;var e=i.arguments[1],u=gformGetShippingPrice(e);n=Math.max(0,n-u);return"percentage"==r?t=n*Number(a/100):"flat"==r&&n<(t=Number(a))&&(t=n),t}),gform.addFilter("gform_product_total",function(a,n){return l("#gform_wrapper_"+n+" .ginput_subtotal_input").each(function(){var t=l(this).val();if(gformIsHidden(l(this)))return 0!==t&&"0"!==t&&l(this).val(0).change(),!0;var r=d({intent:"Calculating subtotal for Subtotal field {0}".format(l(this).attr("id")),total:a,formId:n,amount:null,amountType:null,productsType:l(this).data("productstype"),products:l(this).data("products"),includeShipping:!1});String(t)!=String(r)&&l(this).val(r).change()}),a},48),gform.addFilter("gform_product_total",function(t,r){return t+=p(r,t),Math.max(0,t)},49),gform.addFilter("gform_product_total",function(a,n){var t=l("#gform_wrapper_"+n+" .ginput_tax_input"),o=0;return t.each(function(){var t,r=l(this).val();if(gformIsHidden(l(this)))return 0!==r&&"0"!==r&&l(this).val(0).change(),!0;t=0==a&&"exclude"===l(this).data("productstype")?0:d({intent:"Calculating tax for Tax field {0}".format(l(this).attr("id")),total:a,formId:n,amount:l(this).data("amount"),amountType:l(this).data("amounttype"),products:l(this).data("products"),productsType:l(this).data("productstype"),includeDiscounts:!0}),String(r)!==String(t)&&l(this).val(t).change(),o+=i(t,2)}),i(a+=o,2)},51),gform.addFilter("gform_product_total",function(t,r){var a=l("#gf_coupon_codes_{0}".format(r));return a.data("gpecfChanged")&&(a.data("gpecfChanged",!1),l(document).trigger("gform_post_conditional_logic")),t}),l(document).on("gform_post_render",function(t,r){!function(){if(window.gform){var t=window.gform.hooks.filter.gform_product_total;for(var r in t)t.hasOwnProperty(r)&&-1!==t[r].callable.toString().indexOf("update_dynamic_price_ajax")&&(t[r].priority=52)}}(),l("#gf_coupon_codes_{0}".format(r)).change(function(){l(this).data("gpecfChanged",!0)}),l(document).on("gform_price_change",function(t,r,a){u(r.formId)}),gform.addAction("gpcp_after_update_pricing",function(t,r){u(r._formId)}),gform.addAction("gform_input_change",function(t,r,a){if(window!==t){var n=l(t),o=n.attr("id")&&0===n.attr("id").indexOf("ginput_base_price"),i=n.parents(".gfield").hasClass("gfield_calculation");l(t).data("gpecfIsCalculating")||o&&i&&(l(t).data("gpecfIsCalculating",!0),u(r),l(t).data("gpecfIsCalculating",!1))}});var a=setInterval(function(){window._gformPriceFields&&window._gformPriceFields[r]&&(u(r),clearInterval(a))});l("#gform_wrapper_"+r).find(".ginput_subtotal_input, .ginput_discount_input, .ginput_tax_input").change()})}(jQuery);
//# sourceMappingURL=gp-ecommerce-fields.js.map